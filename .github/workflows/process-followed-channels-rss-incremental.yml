name: Process Followed Channels

on:
  schedule:
    # æ¯ 1 å°æ—¶è¿è¡Œä¸€æ¬¡ (UTC æ—¶é—´) - å¢é‡æ›´æ–°æ›´é«˜æ•ˆï¼Œå¯ä»¥æ›´é¢‘ç¹
    - cron: '0 */1 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  process-followed-channels:
    runs-on: ubuntu-latest
    
    steps:
      - name: Process Followed Channels
        run: |
          echo "Processing followed channels with incremental RSS-based monitoring..."
          echo "This will use RSS feeds to monitor followed channels for new videos with incremental updates"
          
          # è°ƒç”¨å¢é‡RSS-based APIç«¯ç‚¹
          response=$(curl -s -X POST \
            -H "Content-Type: application/json" \
            -d "{\"secret\":\"${{ secrets.CRON_SECRET }}\"}" \
            "${{ secrets.API_BASE_URL }}/api/process-followed-channels-rss-incremental")
          
          echo "Response: $response"
          
          # æ£€æŸ¥å“åº”
          if echo "$response" | grep -q '"success":true'; then
            echo "âœ… Incremental RSS-based followed channels processed successfully"
            echo "ğŸ“Š Check the response for processing statistics"
          else
            echo "âŒ Failed to process followed channels with incremental RSS"
            echo "Response: $response"
            exit 1
          fi
